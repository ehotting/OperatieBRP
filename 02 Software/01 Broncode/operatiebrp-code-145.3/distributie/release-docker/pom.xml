<?xml version="1.0"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>
    <parent>
        <groupId>nl.bzk.brp</groupId>
        <artifactId>distributie-release</artifactId>
        <version>145.3</version>
        <relativePath>../release</relativePath>
    </parent>

    <artifactId>distributie-release-docker</artifactId>
    <packaging>pom</packaging>
    <name>Distributie - Release - Docker</name>

    <properties>
        <docker.image.version>latest</docker.image.version>
    </properties>

    <dependencies>
        <dependency>
            <groupId>nl.bzk.brp</groupId>
            <artifactId>deployment-deployer-docker</artifactId>
            <version>${project.version}</version>
            <type>zip</type>
        </dependency>

        <dependency>
            <groupId>nl.bzk.brp</groupId>
            <artifactId>distributie-docker-brp-admhnd-publicatie</artifactId>
            <version>${project.version}</version>
            <type>pom</type>
        </dependency>
        <dependency>
            <groupId>nl.bzk.brp</groupId>
            <artifactId>distributie-docker-brp-afnemerindicatie</artifactId>
            <version>${project.version}</version>
            <type>pom</type>
        </dependency>
        <dependency>
            <groupId>nl.bzk.brp</groupId>
            <artifactId>distributie-docker-brp-afnemerindicatie-gba</artifactId>
            <version>${project.version}</version>
            <type>pom</type>
        </dependency>
        <dependency>
            <groupId>nl.bzk.brp</groupId>
            <artifactId>distributie-docker-brp-archivering-gba</artifactId>
            <version>${project.version}</version>
            <type>pom</type>
        </dependency>
        <dependency>
            <groupId>nl.bzk.brp</groupId>
            <artifactId>distributie-docker-brp-beheer</artifactId>
            <version>${project.version}</version>
            <type>pom</type>
        </dependency>
        <dependency>
            <groupId>nl.bzk.brp</groupId>
            <artifactId>distributie-docker-brp-bevraging</artifactId>
            <version>${project.version}</version>
            <type>pom</type>
        </dependency>
        <dependency>
            <groupId>nl.bzk.brp</groupId>
            <artifactId>distributie-docker-brp-bevraging-gba</artifactId>
            <version>${project.version}</version>
            <type>pom</type>
        </dependency>
        <dependency>
            <groupId>nl.bzk.brp</groupId>
            <artifactId>distributie-docker-brp-bevraging-gba-ws</artifactId>
            <version>${project.version}</version>
            <type>pom</type>
        </dependency>
        <dependency>
            <groupId>nl.bzk.brp</groupId>
            <artifactId>distributie-docker-brp-bijhouding</artifactId>
            <version>${project.version}</version>
            <type>pom</type>
        </dependency>
        <dependency>
            <groupId>nl.bzk.brp</groupId>
            <artifactId>distributie-docker-brp-bijhouding-gba</artifactId>
            <version>${project.version}</version>
            <type>pom</type>
        </dependency>
        <dependency>
            <groupId>nl.bzk.brp</groupId>
            <artifactId>distributie-docker-brp-database</artifactId>
            <version>${project.version}</version>
            <type>pom</type>
        </dependency>
        <dependency>
            <groupId>nl.bzk.brp</groupId>
            <artifactId>distributie-docker-brp-database-ber</artifactId>
            <version>${project.version}</version>
            <type>pom</type>
        </dependency>
        <dependency>
            <groupId>nl.bzk.brp</groupId>
            <artifactId>distributie-docker-brp-database-kern</artifactId>
            <version>${project.version}</version>
            <type>pom</type>
        </dependency>
        <dependency>
            <groupId>nl.bzk.brp</groupId>
            <artifactId>distributie-docker-brp-database-leeg</artifactId>
            <version>${project.version}</version>
            <type>pom</type>
        </dependency>
        <dependency>
            <groupId>nl.bzk.brp</groupId>
            <artifactId>distributie-docker-brp-database-prot</artifactId>
            <version>${project.version}</version>
            <type>pom</type>
        </dependency>
        <dependency>
            <groupId>nl.bzk.brp</groupId>
            <artifactId>distributie-docker-brp-message-broker</artifactId>
            <version>${project.version}</version>
            <type>pom</type>
        </dependency>
        <dependency>
            <groupId>nl.bzk.brp</groupId>
            <artifactId>distributie-docker-brp-selectie</artifactId>
            <version>${project.version}</version>
            <type>pom</type>
        </dependency>
        <dependency>
            <groupId>nl.bzk.brp</groupId>
            <artifactId>distributie-docker-brp-selectie-schrijver</artifactId>
            <version>${project.version}</version>
            <type>pom</type>
        </dependency>
        <dependency>
            <groupId>nl.bzk.brp</groupId>
            <artifactId>distributie-docker-brp-selectie-verwerker</artifactId>
            <version>${project.version}</version>
            <type>pom</type>
        </dependency>
        <dependency>
            <groupId>nl.bzk.brp</groupId>
            <artifactId>distributie-docker-brp-selectie-afnemerindicatie</artifactId>
            <version>${project.version}</version>
            <type>pom</type>
        </dependency>
        <dependency>
            <groupId>nl.bzk.brp</groupId>
            <artifactId>distributie-docker-brp-stuf</artifactId>
            <version>${project.version}</version>
            <type>pom</type>
        </dependency>
        <dependency>
            <groupId>nl.bzk.brp</groupId>
            <artifactId>distributie-docker-brp-selectie-message-broker</artifactId>
            <version>${project.version}</version>
            <type>pom</type>
        </dependency>
        <dependency>
            <groupId>nl.bzk.brp</groupId>
            <artifactId>distributie-docker-brp-mutatielevering</artifactId>
            <version>${project.version}</version>
            <type>pom</type>
        </dependency>
        <dependency>
            <groupId>nl.bzk.brp</groupId>
            <artifactId>distributie-docker-brp-sleutel</artifactId>
            <version>${project.version}</version>
            <type>pom</type>
        </dependency>
        <dependency>
            <groupId>nl.bzk.brp</groupId>
            <artifactId>distributie-docker-brp-synchronisatie</artifactId>
            <version>${project.version}</version>
            <type>pom</type>
        </dependency>
        <dependency>
            <groupId>nl.bzk.brp</groupId>
            <artifactId>distributie-docker-brp-verzending</artifactId>
            <version>${project.version}</version>
            <type>pom</type>
        </dependency>
        <dependency>
            <groupId>nl.bzk.brp</groupId>
            <artifactId>distributie-docker-brp-vrijbericht</artifactId>
            <version>${project.version}</version>
            <type>pom</type>
        </dependency>
        <dependency>
            <groupId>nl.bzk.brp</groupId>
            <artifactId>distributie-docker-isc-isc</artifactId>
            <version>${project.version}</version>
            <type>pom</type>
        </dependency>
        <dependency>
            <groupId>nl.bzk.brp</groupId>
            <artifactId>distributie-docker-isc-isc-console</artifactId>
            <version>${project.version}</version>
            <type>pom</type>
        </dependency>
        <dependency>
            <groupId>nl.bzk.brp</groupId>
            <artifactId>distributie-docker-isc-isc-database</artifactId>
            <version>${project.version}</version>
            <type>pom</type>
        </dependency>
        <dependency>
            <groupId>nl.bzk.brp</groupId>
            <artifactId>distributie-docker-isc-routering</artifactId>
            <version>${project.version}</version>
            <type>pom</type>
        </dependency>
        <dependency>
            <groupId>nl.bzk.brp</groupId>
            <artifactId>distributie-docker-isc-synchronisatie</artifactId>
            <version>${project.version}</version>
            <type>pom</type>
        </dependency>
        <dependency>
            <groupId>nl.bzk.brp</groupId>
            <artifactId>distributie-docker-isc-voisc</artifactId>
            <version>${project.version}</version>
            <type>pom</type>
        </dependency>
        <dependency>
            <groupId>nl.bzk.brp</groupId>
            <artifactId>distributie-docker-isc-voisc-database</artifactId>
            <version>${project.version}</version>
            <type>pom</type>
        </dependency>
        <dependency>
            <groupId>nl.bzk.brp</groupId>
            <artifactId>distributie-docker-iv-hornetq</artifactId>
            <version>${project.version}</version>
            <type>pom</type>
        </dependency>
        <dependency>
            <groupId>nl.bzk.brp</groupId>
            <artifactId>distributie-docker-iv-logging</artifactId>
            <version>${project.version}</version>
            <type>pom</type>
        </dependency>
        <dependency>
            <groupId>nl.bzk.brp</groupId>
            <artifactId>distributie-docker-iv-naarbrp</artifactId>
            <version>${project.version}</version>
            <type>pom</type>
        </dependency>
        <dependency>
            <groupId>nl.bzk.brp</groupId>
            <artifactId>distributie-docker-iv-naarlo3</artifactId>
            <version>${project.version}</version>
            <type>pom</type>
        </dependency>
        <dependency>
            <groupId>nl.bzk.brp</groupId>
            <artifactId>distributie-docker-iv-naarvoisc</artifactId>
            <version>${project.version}</version>
            <type>pom</type>
        </dependency>
        <dependency>
            <groupId>nl.bzk.brp</groupId>
            <artifactId>distributie-docker-iv-synchronisatie-naarbrp</artifactId>
            <version>${project.version}</version>
            <type>pom</type>
        </dependency>
        <dependency>
            <groupId>nl.bzk.brp</groupId>
            <artifactId>distributie-docker-iv-synchronisatie-naarlo3</artifactId>
            <version>${project.version}</version>
            <type>pom</type>
        </dependency>
        <dependency>
            <groupId>nl.bzk.brp</groupId>
            <artifactId>distributie-docker-logging-elasticsearch</artifactId>
            <version>${project.version}</version>
            <type>pom</type>
        </dependency>
        <dependency>
            <groupId>nl.bzk.brp</groupId>
            <artifactId>distributie-docker-logging-kibana</artifactId>
            <version>${project.version}</version>
            <type>pom</type>
        </dependency>
        <dependency>
            <groupId>nl.bzk.brp</groupId>
            <artifactId>distributie-docker-logging-logstash</artifactId>
            <version>${project.version}</version>
            <type>pom</type>
        </dependency>
        <dependency>
            <groupId>nl.bzk.brp</groupId>
            <artifactId>distributie-docker-tools-afnemervoorbeeld</artifactId>
            <version>${project.version}</version>
            <type>pom</type>
        </dependency>
        <dependency>
            <groupId>nl.bzk.brp</groupId>
            <artifactId>distributie-docker-tools-afnemervoorbeeld-database</artifactId>
            <version>${project.version}</version>
            <type>pom</type>
        </dependency>
        <dependency>
            <groupId>nl.bzk.brp</groupId>
            <artifactId>distributie-docker-tools-controle</artifactId>
            <version>${project.version}</version>
            <type>pom</type>
        </dependency>
        <dependency>
            <groupId>nl.bzk.brp</groupId>
            <artifactId>distributie-docker-tools-gbav-database</artifactId>
            <version>${project.version}</version>
            <type>pom</type>
        </dependency>
        <dependency>
            <groupId>nl.bzk.brp</groupId>
            <artifactId>distributie-docker-tools-ggo</artifactId>
            <version>${project.version}</version>
            <type>pom</type>
        </dependency>
        <dependency>
            <groupId>nl.bzk.brp</groupId>
            <artifactId>distributie-docker-tools-ggo-database</artifactId>
            <version>${project.version}</version>
            <type>pom</type>
        </dependency>
        <dependency>
            <groupId>nl.bzk.brp</groupId>
            <artifactId>distributie-docker-tools-graphite</artifactId>
            <version>${project.version}</version>
            <type>pom</type>
        </dependency>
        <dependency>
            <groupId>nl.bzk.brp</groupId>
            <artifactId>distributie-docker-tools-jmxcollector</artifactId>
            <version>${project.version}</version>
            <type>pom</type>
        </dependency>
        <dependency>
            <groupId>nl.bzk.brp</groupId>
            <artifactId>distributie-docker-tools-levering-vergelijker</artifactId>
            <version>${project.version}</version>
            <type>pom</type>
        </dependency>
        <dependency>
            <groupId>nl.bzk.brp</groupId>
            <artifactId>distributie-docker-tools-mailbox</artifactId>
            <version>${project.version}</version>
            <type>pom</type>
        </dependency>
        <dependency>
            <groupId>nl.bzk.brp</groupId>
            <artifactId>distributie-docker-tools-mailbox-database</artifactId>
            <version>${project.version}</version>
            <type>pom</type>
        </dependency>
        <dependency>
            <groupId>nl.bzk.brp</groupId>
            <artifactId>distributie-docker-tools-proefsynchronisatie</artifactId>
            <version>${project.version}</version>
            <type>pom</type>
        </dependency>
    </dependencies>

    <profiles>

        <profile>
            <id>docker-release</id>
            <properties>
                <docker.image.version>release-${project.version}</docker.image.version>
            </properties>
            <build>
                <plugins>
                    <plugin>
                        <groupId>org.codehaus.mojo</groupId>
                        <artifactId>exec-maven-plugin</artifactId>
                        <executions>
                            <execution>
                                <id>docker-export-brp</id>
                                <phase>verify</phase>
                                <goals>
                                    <goal>exec</goal>
                                </goals>
                                <configuration>
                                    <workingDirectory>target</workingDirectory>
                                    <executable>docker</executable>
                                    <commandlineArgs>
                                        save --output=brp-${docker.image.version}.tar
                                        brp/sleutel:${docker.image.version}
                                        brp/afnemerindicatie:${docker.image.version}
                                        brp/afnemerindicatie-gba:${docker.image.version}
                                        brp/archivering-gba:${docker.image.version}
                                        brp/admhnd-publicatie:${docker.image.version}
                                        brp/beheer:${docker.image.version}
                                        brp/bevraging:${docker.image.version}
                                        brp/bevraging-gba:${docker.image.version}
                                        brp/bevraging-gba-ws:${docker.image.version}
                                        brp/bijhouding:${docker.image.version}
                                        brp/bijhouding-gba:${docker.image.version}
                                        brp/database:${docker.image.version}
                                        brp/database-leeg:${docker.image.version}
                                        brp/database-ber:${docker.image.version}
                                        brp/database-kern:${docker.image.version}
                                        brp/database-prot:${docker.image.version}
                                        brp/message-broker:${docker.image.version}
                                        brp/mutatielevering:${docker.image.version}
                                        brp/synchronisatie:${docker.image.version}
                                        brp/verzending:${docker.image.version}
                                        brp/vrijbericht:${docker.image.version}
                                        brp/selectie:${docker.image.version}
                                        brp/selectie-schrijver:${docker.image.version}
                                        brp/selectie-verwerker:${docker.image.version}
                                        brp/selectie-afnemerindicatie:${docker.image.version}
                                        brp/selectie-message-broker:${docker.image.version}
                                        brp/stuf:${docker.image.version}
                                    </commandlineArgs>
                                </configuration>
                            </execution>
                            <execution>
                                <id>docker-export-logging</id>
                                <phase>verify</phase>
                                <goals>
                                    <goal>exec</goal>
                                </goals>
                                <configuration>
                                    <workingDirectory>target</workingDirectory>
                                    <executable>docker</executable>
                                    <commandlineArgs>
                                        save --output=logging-${docker.image.version}.tar
                                        logging/elasticsearch:${docker.image.version}
                                        logging/logstash:${docker.image.version}
                                        logging/kibana:${docker.image.version}
                                    </commandlineArgs>
                                </configuration>
                            </execution>

                            <execution>
                                <id>docker-export-isc</id>
                                <phase>verify</phase>
                                <goals>
                                    <goal>exec</goal>
                                </goals>
                                <configuration>
                                    <workingDirectory>target</workingDirectory>
                                    <executable>docker</executable>
                                    <commandlineArgs>
                                        save --output=isc-${docker.image.version}.tar
                                        isc/isc-database:${docker.image.version}
                                        isc/isc:${docker.image.version}
                                        isc/isc-console:${docker.image.version}
                                        isc/routering:${docker.image.version}
                                        isc/synchronisatie:${docker.image.version}
                                        isc/voisc-database:${docker.image.version}
                                        isc/voisc:${docker.image.version}
                                    </commandlineArgs>
                                </configuration>
                            </execution>
                            <execution>
                                <id>docker-export-iv</id>
                                <phase>verify</phase>
                                <goals>
                                    <goal>exec</goal>
                                </goals>
                                <configuration>
                                    <workingDirectory>target</workingDirectory>
                                    <executable>docker</executable>
                                    <commandlineArgs>
                                        save --output=iv-${docker.image.version}.tar
                                        iv/hornetq:${docker.image.version}
                                        iv/logging:${docker.image.version}
                                        iv/naarbrp:${docker.image.version}
                                        iv/naarlo3:${docker.image.version}
                                        iv/naarvoisc:${docker.image.version}
                                        iv/synchronisatie-naarbrp:${docker.image.version}
                                        iv/synchronisatie-naarlo3:${docker.image.version}
                                    </commandlineArgs>
                                </configuration>
                            </execution>
                            <execution>
                                <id>docker-export-tools</id>
                                <phase>verify</phase>
                                <goals>
                                    <goal>exec</goal>
                                </goals>
                                <configuration>
                                    <workingDirectory>target</workingDirectory>
                                    <executable>docker</executable>
                                    <commandlineArgs>
                                        save --output=tools-${docker.image.version}.tar
                                        brp/afnemervoorbeeld:${docker.image.version}
                                        brp/database-afnemervb:${docker.image.version}
                                        migr/gbav-database:${docker.image.version}
                                        migr/ggo-database:${docker.image.version}
                                        migr/ggo-viewer:${docker.image.version}
                                        migr/mailbox:${docker.image.version}
                                        migr/mailbox-database:${docker.image.version}
                                        migr/jmxcollector:${docker.image.version}
                                        migr/graphite:${docker.image.version}
                                        tools/levering-vergelijker:${docker.image.version}
                                        tools/proefsynchronisatie:${docker.image.version}
                                    </commandlineArgs>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>

                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-dependency-plugin</artifactId>
                        <executions>
                            <execution>
                                <id>copy-zips</id>
                                <phase>prepare-package</phase>
                                <goals>
                                    <goal>copy</goal>
                                </goals>
                                <configuration>
                                    <stripClassifier>true</stripClassifier>
                                    <stripVersion>true</stripVersion>
                                    <outputDirectory>target</outputDirectory>
                                    <artifactItems>
                                        <artifactItem>
                                            <groupId>nl.bzk.brp</groupId>
                                            <artifactId>deployment-deployer-docker</artifactId>
                                            <version>${project.version}</version>
                                            <type>zip</type>
                                            <destFileName>deployer-docker.zip</destFileName>
                                        </artifactItem>
                                    </artifactItems>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>

                    <plugin>
                        <groupId>org.codehaus.mojo</groupId>
                        <artifactId>build-helper-maven-plugin</artifactId>
                        <executions>
                            <execution>
                                <id>attach-artifacts</id>
                                <phase>install</phase>
                                <goals>
                                    <goal>attach-artifact</goal>
                                </goals>
                                <configuration>
                                    <artifacts>
                                        <artifact>
                                            <file>target/brp-${docker.image.version}.tar</file>
                                            <type>tar</type>
                                            <classifier>brp</classifier>
                                        </artifact>
                                        <artifact>
                                            <file>target/isc-${docker.image.version}.tar</file>
                                            <type>tar</type>
                                            <classifier>isc</classifier>
                                        </artifact>
                                        <artifact>
                                            <file>target/iv-${docker.image.version}.tar</file>
                                            <type>tar</type>
                                            <classifier>iv</classifier>
                                        </artifact>
                                        <artifact>
                                            <file>target/logging-${docker.image.version}.tar</file>
                                            <type>tar</type>
                                            <classifier>logging</classifier>
                                        </artifact>
                                        <artifact>
                                            <file>target/tools-${docker.image.version}.tar</file>
                                            <type>tar</type>
                                            <classifier>tools</classifier>
                                        </artifact>
                                        <artifact>
                                            <file>target/deployer-docker.zip</file>
                                            <type>zip</type>
                                            <classifier>deployer</classifier>
                                        </artifact>
                                    </artifacts>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                </plugins>
            </build>
        </profile>
    </profiles>
</project>
