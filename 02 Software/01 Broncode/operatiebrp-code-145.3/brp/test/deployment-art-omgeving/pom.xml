<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>
    <parent>
        <groupId>nl.bzk.algemeenbrp</groupId>
        <artifactId>alg</artifactId>
        <version>146-SNAPSHOT</version>
        <relativePath>../../../algemeen/alg</relativePath>
    </parent>
    <groupId>nl.bzk.brp.test</groupId>
    <artifactId>brp-test-art-omgeving</artifactId>
    <packaging>jar</packaging>
    <name>BRP Test Deployment ART omgeving</name>
    <description>Dit project wordt gebruikt om lokaal je ART test omgeving in te kunnen richten. SoapUI voorzien van de
        juiste JAR's en het gebruiken van de laatste versie van de ART-Engine
    </description>
    <properties>
        <!--
        GEEN LATEST MEER GEBRUIKEN AUB, ONDERSTAANDE PROPERTIES WORDEN GEVULD VANUIT PROFILE
        <project.brp.database.versie>LATEST</project.brp.database.versie>
        <project.brp.art.engine.versie>LATEST</project.brp.art.engine.versie>
        <project.brp.art.data.versie>LATEST</project.brp.art.data.versie>
        -->
        <brp.release.version>132.2</brp.release.version>
        <brp.algemeen.release.version>132.2</brp.algemeen.release.version>

        <!-- Properties die overschreven worden vanuit Jenkins/command-line -->
        <dbhost>localhost</dbhost>
        <dbprefix>art-</dbprefix>
        <dbusername>brp</dbusername>
        <dbpassword>brp</dbpassword>
        <dbdriver>org.postgresql.Driver</dbdriver>

        <!-- Zet hier de soapUI versie neer die je gebruikt, zodat het pad waar de jar files die voor de art-engine nodig zijn correct is -->
        <soapui.version>5.0.0</soapui.version>
        <soapui.directory.macosx>/Applications/SoapUI-${soapui.version}.app/Contents/java/app/lib/
        </soapui.directory.macosx>
        <soapui.directory.windows>C:\Program Files (x86)\SmartBear\SoapUI-${soapui.version}\lib\
        </soapui.directory.windows>
        <soapui.directory.linux>/opt/soapui-${soapui.version}/lib/</soapui.directory.linux>
        <sqlfile>art-testdata.sql</sqlfile>

        <!-- DB Properties -->
        <db.kern.driver>${dbdriver}</db.kern.driver>
        <db.kern.url>jdbc:postgresql://${dbhost}/${dbprefix}brp</db.kern.url>
        <db.kern.username>${dbusername}</db.kern.username>
        <db.kern.password>${dbpassword}</db.kern.password>

        <db.lev.driver>${dbdriver}</db.lev.driver>
        <db.lev.url>jdbc:postgresql://${dbhost}/${dbprefix}brp-lev</db.lev.url>
        <db.lev.username>${dbusername}</db.lev.username>
        <db.lev.password>${dbpassword}</db.lev.password>

        <db.ber.driver>${dbdriver}</db.ber.driver>
        <db.ber.url>jdbc:postgresql://${dbhost}/${dbprefix}brp-ber</db.ber.url>
        <db.ber.username>${dbusername}</db.ber.username>
        <db.ber.password>${dbpassword}</db.ber.password>

        <db.activemq.driver>${dbdriver}</db.activemq.driver>
        <db.activemq.url>jdbc:postgresql://${dbhost}/${dbprefix}activemq</db.activemq.url>
        <db.activemq.username>${dbusername}</db.activemq.username>
        <db.activemq.password>${dbpassword}</db.activemq.password>

        <db.afnemer.driver>${dbdriver}</db.afnemer.driver>
        <db.afnemer.url>jdbc:postgresql://${dbhost}/${dbprefix}brp</db.afnemer.url>
        <db.afnemer.username>${dbusername}</db.afnemer.username>
        <db.afnemer.password>${dbpassword}</db.afnemer.password>

        <art.engine.directory>${project.basedir}/art-engine</art.engine.directory>
        <art.afhankelijkheden.directory>${art.engine.directory}/afhankelijkheden</art.afhankelijkheden.directory>

        <!-- Er zou een "Test-Parent" pom moete bestaan zodat testers die enkel test hebben uitgechecked ook versie hebben -->
        <postgres.version>9.2-1004-jdbc41</postgres.version>

        <dbcreate.skip>false</dbcreate.skip>
    </properties>
    <dependencies>
        <dependency>
            <groupId>org.postgresql</groupId>
            <artifactId>postgresql</artifactId>
            <version>${postgres.version}</version>
        </dependency>
        <dependency>
            <groupId>net.sourceforge.jexcelapi</groupId>
            <artifactId>jxl</artifactId>
            <version>2.6.12</version>
        </dependency>
        <dependency>
            <groupId>jp.skypencil.java-diff-utils</groupId>
            <artifactId>diffutils</artifactId>
            <version>1.4.1</version>
        </dependency>
        <dependency>
            <groupId>nl.bzk.brp</groupId>
            <artifactId>brp-test-testdata</artifactId>
            <version>${project.brp.art.data.versie}</version>
            <type>zip</type>
            <classifier>sql</classifier>
        </dependency>
        <dependency>
            <groupId>nl.bzk.algemeenbrp</groupId>
            <artifactId>alg-test-dal</artifactId>
            <version>${project.brp.algemeen.version}</version>
        </dependency>
    </dependencies>
    <build>
        <plugins>
            <plugin>
                <artifactId>maven-clean-plugin</artifactId>
                <version>2.5</version>
                <configuration>
                    <filesets>
                        <fileset>
                            <directory>${art.afhankelijkheden.directory}</directory>
                        </fileset>
                        <fileset>
                            <directory>${art.engine.directory}</directory>
                        </fileset>
                    </filesets>
                </configuration>
            </plugin>

        </plugins>
    </build>
    <profiles>
        <profile>
            <id>nieuwste</id>
            <activation>
                <activeByDefault>true</activeByDefault>
            </activation>
            <properties>
                <!--GEEN LATEST MEER GEBRUIKEN AUB-->
                <project.brp.database.versie>${project.version}</project.brp.database.versie>
                <project.brp.art.data.versie>${project.version}</project.brp.art.data.versie>
                <project.brp.art.engine.versie>${project.version}</project.brp.art.engine.versie>
                <project.brp.algemeen.version>${project.version}</project.brp.algemeen.version>
            </properties>
            <build>
                <plugins>
                    <plugin>
                        <groupId>org.codehaus.mojo</groupId>
                        <artifactId>versions-maven-plugin</artifactId>
                        <version>1.2</version>
                        <executions>
                            <execution>
                                <id>update-versions</id>
                                <phase>initialize</phase>
                                <goals>
                                    <goal>use-latest-versions</goal>
                                </goals>
                            </execution>
                        </executions>
                        <configuration>
                            <includesList>nl.bzk.brp</includesList>
                            <generateBackupPoms>false</generateBackupPoms>
                            <allowSnapshots>true</allowSnapshots>
                        </configuration>
                    </plugin>
                </plugins>
            </build>
        </profile>
        <profile>
            <id>release</id>
            <properties>
                <!--GEEN LATEST MEER GEBRUIKEN AUB-->
                <project.brp.database.versie>${brp.release.version}</project.brp.database.versie>
                <project.brp.art.data.versie>${brp.release.version}</project.brp.art.data.versie>
                <project.brp.art.engine.versie>${brp.release.version}</project.brp.art.engine.versie>
                <project.brp.algemeen.version>${brp.algemeen.release.version}</project.brp.algemeen.version>
            </properties>
        </profile>

        <profile>
            <id>create-test-db</id>
            <activation>
                <property>
                    <name>create-test-db</name>
                    <value>true</value>
                </property>
            </activation>
            <build>
                <plugins>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-dependency-plugin</artifactId>
                        <executions>
                            <execution>
                                <id>unpack-brp-test-testdata</id>
                                <phase>generate-resources</phase>
                                <goals>
                                    <goal>unpack</goal>
                                </goals>
                                <configuration>
                                    <artifactItems>
                                        <artifactItem>
                                            <groupId>nl.bzk.brp</groupId>
                                            <artifactId>brp-test-testdata</artifactId>
                                            <version>${project.brp.art.data.versie}</version>
                                            <classifier>sql</classifier>
                                            <type>zip</type>
                                            <overWrite>false</overWrite>
                                            <outputDirectory>${project.build.directory}/brp-test-testdata
                                            </outputDirectory>
                                            <includes>**/*.sql</includes>
                                        </artifactItem>
                                    </artifactItems>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                    <plugin>
                        <groupId>org.liquibase</groupId>
                        <artifactId>liquibase-maven-plugin</artifactId>
                        <configuration>
                            <skip>${dbcreate.skip}</skip>
                        </configuration>
                        <executions>
                            <!-- Maak de structuur van de BRP database en vul deze met stamgegevens -->
                            <execution>
                                <id>maak-database</id>
                                <phase>process-resources</phase>
                                <goals>
                                    <goal>update</goal>
                                </goals>
                                <configuration>
                                    <dropFirst>true</dropFirst>
                                    <changeLogFile>liquibase/changeset/brp-databases.xml</changeLogFile>
                                    <promptOnNonLocalDatabase>false</promptOnNonLocalDatabase>
                                    <!-- Alles in 1 database in dit profiel -->
                                    <driver>${db.kern.driver}</driver>
                                    <url>${db.kern.url}</url>
                                    <username>${db.kern.username}</username>
                                    <password>${db.kern.password}</password>
                                </configuration>
                            </execution>
                            <!-- Schoon de activemq database op, zodat er geen oude berichten blijven staan. -->
                            <execution>
                                <id>clear-activemq</id>
                                <phase>process-resources</phase>
                                <goals>
                                    <goal>update</goal>
                                </goals>
                                <configuration>
                                    <dropFirst>true</dropFirst>
                                    <promptOnNonLocalDatabase>false</promptOnNonLocalDatabase>
                                    <changeLogFile>liquibase/changeset/activemq.xml</changeLogFile>
                                    <driver>${db.activemq.driver}</driver>
                                    <url>${db.activemq.url}</url>
                                    <username>${db.activemq.username}</username>
                                    <password>${db.activemq.password}</password>
                                </configuration>
                            </execution>
                            <!-- overload de create-db execution uit brp-parent, zodat deze niet uitgevoerd wordt. -->
                            <execution>
                                <id>create-db</id>
                                <phase>none</phase>
                            </execution>
                        </executions>
                    </plugin>
                    <!-- Vul de database met testdata -->
                    <plugin>
                        <groupId>org.codehaus.mojo</groupId>
                        <artifactId>sql-maven-plugin</artifactId>
                        <version>1.5</version>
                        <configuration>
                            <driver>${db.kern.driver}</driver>
                            <url>${db.kern.url}</url>
                            <username>${db.kern.username}</username>
                            <password>${db.kern.password}</password>
                        </configuration>
                        <executions>
                            <execution>
                                <id>fill-data</id>
                                <phase>process-classes</phase>
                                <goals>
                                    <goal>execute</goal>
                                </goals>
                                <configuration>
                                    <autocommit>true</autocommit>
                                    <srcFiles>
                                        <srcFile>${project.build.directory}/brp-test-testdata/${sqlfile}</srcFile>
                                    </srcFiles>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                </plugins>
            </build>
        </profile>
        <profile>
            <id>create-test-db-docker-bijhouding</id>
            <activation>
                <property>
                    <name>create-test-db</name>
                    <value>true</value>
                </property>
            </activation>
            <build>
                <plugins>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-dependency-plugin</artifactId>
                        <executions>
                            <execution>
                                <id>unpack-brp-test-testdata</id>
                                <phase>generate-resources</phase>
                                <goals>
                                    <goal>unpack</goal>
                                </goals>
                                <configuration>
                                    <artifactItems>
                                        <artifactItem>
                                            <groupId>nl.bzk.brp</groupId>
                                            <artifactId>brp-test-testdata</artifactId>
                                            <version>${project.brp.art.data.versie}</version>
                                            <classifier>sql</classifier>
                                            <type>zip</type>
                                            <overWrite>false</overWrite>
                                            <outputDirectory>${project.build.directory}/brp-test-testdata
                                            </outputDirectory>
                                            <includes>**/*.sql</includes>
                                        </artifactItem>
                                    </artifactItems>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                    <!-- Vul de database met testdata -->
                    <plugin>
                        <groupId>org.codehaus.mojo</groupId>
                        <artifactId>sql-maven-plugin</artifactId>
                        <configuration>
                            <driver>${db.kern.driver}</driver>
                            <url>${db.kern.url}</url>
                            <username>${db.kern.username}</username>
                            <password>${db.kern.password}</password>
                        </configuration>
                        <executions>
                            <execution>
                                <id>fill-data</id>
                                <phase>process-classes</phase>
                                <goals>
                                    <goal>execute</goal>
                                </goals>
                                <configuration>
                                    <autocommit>true</autocommit>
                                    <srcFiles>
                                        <srcFile>${project.build.directory}/brp-test-testdata/${sqlfile}</srcFile>
                                    </srcFiles>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                </plugins>
            </build>
        </profile>
    </profiles>
</project>
